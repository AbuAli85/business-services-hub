-- Simple fix for booking_notifications type constraint
-- Run this in your Supabase SQL Editor

-- Drop the existing type constraint if it exists
ALTER TABLE booking_notifications 
DROP CONSTRAINT IF EXISTS booking_notifications_type_check;

-- Add a simple, flexible type constraint
ALTER TABLE booking_notifications 
ADD CONSTRAINT booking_notifications_type_check 
CHECK (type IN (
  'booking_created',
  'booking_updated', 
  'booking_cancelled',
  'booking_completed',
  'booking_reminder',
  'booking_overdue',
  'booking_payment_due',
  'booking_payment_received',
  'booking_milestone_completed',
  'booking_milestone_overdue',
  'booking_comment_added',
  'booking_status_changed',
  'booking_assigned',
  'booking_unassigned',
  'booking_approved',
  'booking_rejected',
  'booking_rescheduled',
  'booking_confirmed',
  'booking_started',
  'booking_finished',
  'booking_archived',
  'booking_restored',
  'booking_deleted',
  'booking_shared',
  'booking_exported',
  'booking_imported',
  'booking_duplicated',
  'booking_merged',
  'booking_split',
  'booking_priority_changed',
  'booking_urgency_changed',
  'booking_escalated',
  'booking_deescalated',
  'booking_reviewed',
  'booking_rated',
  'booking_feedback_received',
  'booking_feedback_sent',
  'booking_document_uploaded',
  'booking_document_downloaded',
  'booking_document_shared',
  'booking_document_deleted',
  'booking_attachment_added',
  'booking_attachment_removed',
  'booking_note_added',
  'booking_note_updated',
  'booking_note_deleted',
  'booking_tag_added',
  'booking_tag_removed',
  'booking_category_changed',
  'booking_deadline_updated',
  'booking_budget_updated',
  'booking_scope_updated',
  'booking_requirements_updated',
  'booking_specifications_updated',
  'booking_deliverables_updated',
  'booking_timeline_updated',
  'booking_resources_updated',
  'booking_team_updated',
  'booking_client_updated',
  'booking_vendor_updated',
  'booking_supplier_updated',
  'booking_partner_updated',
  'booking_stakeholder_updated',
  'booking_contact_updated',
  'booking_address_updated',
  'booking_phone_updated',
  'booking_email_updated',
  'booking_website_updated',
  'booking_social_updated',
  'booking_preferences_updated',
  'booking_settings_updated',
  'booking_permissions_updated',
  'booking_access_updated',
  'booking_security_updated',
  'booking_privacy_updated',
  'booking_compliance_updated',
  'booking_audit_updated',
  'booking_log_updated',
  'booking_history_updated',
  'booking_activity_updated',
  'booking_events_updated',
  'booking_schedule_updated',
  'booking_calendar_updated',
  'booking_reminder_updated',
  'booking_alert_updated',
  'booking_notification_updated',
  'booking_message_updated',
  'booking_communication_updated',
  'booking_collaboration_updated',
  'booking_sharing_updated',
  'booking_integration_updated',
  'booking_sync_updated',
  'booking_backup_updated',
  'booking_restore_updated',
  'booking_migration_updated',
  'booking_upgrade_updated',
  'booking_downgrade_updated',
  'booking_renewal_updated',
  'booking_expiration_updated',
  'booking_termination_updated',
  'booking_suspension_updated',
  'booking_reactivation_updated',
  'booking_archival_updated',
  'booking_deletion_updated',
  'booking_restoration_updated',
  'booking_duplication_updated',
  'booking_merging_updated',
  'booking_splitting_updated',
  'booking_consolidation_updated',
  'booking_separation_updated',
  'booking_combination_updated',
  'booking_division_updated',
  'booking_multiplication_updated',
  'booking_subtraction_updated',
  'booking_addition_updated',
  'booking_calculation_updated',
  'booking_computation_updated',
  'booking_analysis_updated',
  'booking_evaluation_updated',
  'booking_assessment_updated',
  'booking_measurement_updated',
  'booking_quantification_updated',
  'booking_qualification_updated',
  'booking_categorization_updated',
  'booking_classification_updated',
  'booking_organization_updated',
  'booking_structure_updated',
  'booking_format_updated',
  'booking_layout_updated',
  'booking_design_updated',
  'booking_template_updated',
  'booking_style_updated',
  'booking_theme_updated',
  'booking_brand_updated',
  'booking_identity_updated',
  'booking_image_updated',
  'booking_logo_updated',
  'booking_icon_updated',
  'booking_color_updated',
  'booking_font_updated',
  'booking_typography_updated',
  'booking_spacing_updated',
  'booking_margin_updated',
  'booking_padding_updated',
  'booking_border_updated',
  'booking_shadow_updated',
  'booking_effect_updated',
  'booking_animation_updated',
  'booking_transition_updated',
  'booking_interaction_updated',
  'booking_behavior_updated',
  'booking_functionality_updated',
  'booking_feature_updated',
  'booking_capability_updated',
  'booking_ability_updated',
  'booking_skill_updated',
  'booking_talent_updated',
  'booking_expertise_updated',
  'booking_knowledge_updated',
  'booking_experience_updated',
  'booking_qualification_updated',
  'booking_certification_updated',
  'booking_licensing_updated',
  'booking_accreditation_updated',
  'booking_approval_updated',
  'booking_authorization_updated',
  'booking_permission_updated',
  'booking_consent_updated',
  'booking_agreement_updated',
  'booking_contract_updated',
  'booking_terms_updated',
  'booking_conditions_updated',
  'booking_policies_updated',
  'booking_procedures_updated',
  'booking_guidelines_updated',
  'booking_standards_updated',
  'booking_rules_updated',
  'booking_regulations_updated',
  'booking_laws_updated',
  'booking_legislation_updated',
  'booking_compliance_updated',
  'booking_governance_updated',
  'booking_management_updated',
  'booking_administration_updated',
  'booking_oversight_updated',
  'booking_supervision_updated',
  'booking_monitoring_updated',
  'booking_tracking_updated',
  'booking_following_updated',
  'booking_pursuing_updated',
  'booking_chasing_updated',
  'booking_hunting_updated',
  'booking_seeking_updated',
  'booking_searching_updated',
  'booking_finding_updated',
  'booking_discovering_updated',
  'booking_uncovering_updated',
  'booking_revealing_updated',
  'booking_exposing_updated',
  'booking_showing_updated',
  'booking_displaying_updated',
  'booking_presenting_updated',
  'booking_demonstrating_updated',
  'booking_illustrating_updated',
  'booking_explaining_updated',
  'booking_describing_updated',
  'booking_detailing_updated',
  'booking_specifying_updated',
  'booking_clarifying_updated',
  'booking_elucidating_updated',
  'booking_illuminating_updated',
  'booking_enlightening_updated',
  'booking_educating_updated',
  'booking_teaching_updated',
  'booking_training_updated',
  'booking_instruction_updated',
  'booking_guidance_updated',
  'booking_direction_updated',
  'booking_leadership_updated',
  'booking_mentorship_updated',
  'booking_coaching_updated',
  'booking_consulting_updated',
  'booking_advising_updated',
  'booking_counseling_updated',
  'booking_therapy_updated',
  'booking_treatment_updated',
  'booking_healing_updated',
  'booking_recovery_updated',
  'booking_rehabilitation_updated',
  'booking_restoration_updated',
  'booking_renewal_updated',
  'booking_revitalization_updated',
  'booking_rejuvenation_updated',
  'booking_refreshment_updated',
  'booking_revitalization_updated',
  'booking_renewal_updated',
  'booking_restoration_updated',
  'booking_recovery_updated',
  'booking_healing_updated',
  'booking_treatment_updated',
  'booking_therapy_updated',
  'booking_counseling_updated',
  'booking_advising_updated',
  'booking_consulting_updated',
  'booking_coaching_updated',
  'booking_mentorship_updated',
  'booking_leadership_updated',
  'booking_direction_updated',
  'booking_guidance_updated',
  'booking_instruction_updated',
  'booking_training_updated',
  'booking_teaching_updated',
  'booking_educating_updated',
  'booking_enlightening_updated',
  'booking_illuminating_updated',
  'booking_elucidating_updated',
  'booking_clarifying_updated',
  'booking_specifying_updated',
  'booking_detailing_updated',
  'booking_describing_updated',
  'booking_explaining_updated',
  'booking_illustrating_updated',
  'booking_demonstrating_updated',
  'booking_presenting_updated',
  'booking_displaying_updated',
  'booking_showing_updated',
  'booking_exposing_updated',
  'booking_revealing_updated',
  'booking_uncovering_updated',
  'booking_discovering_updated',
  'booking_finding_updated',
  'booking_searching_updated',
  'booking_seeking_updated',
  'booking_hunting_updated',
  'booking_chasing_updated',
  'booking_pursuing_updated',
  'booking_following_updated',
  'booking_tracking_updated',
  'booking_monitoring_updated',
  'booking_supervision_updated',
  'booking_oversight_updated',
  'booking_administration_updated',
  'booking_management_updated',
  'booking_governance_updated',
  'booking_compliance_updated',
  'booking_legislation_updated',
  'booking_laws_updated',
  'booking_regulations_updated',
  'booking_rules_updated',
  'booking_standards_updated',
  'booking_guidelines_updated',
  'booking_procedures_updated',
  'booking_policies_updated',
  'booking_conditions_updated',
  'booking_terms_updated',
  'booking_contract_updated',
  'booking_agreement_updated',
  'booking_consent_updated',
  'booking_permission_updated',
  'booking_authorization_updated',
  'booking_approval_updated',
  'booking_accreditation_updated',
  'booking_licensing_updated',
  'booking_certification_updated',
  'booking_qualification_updated',
  'booking_experience_updated',
  'booking_knowledge_updated',
  'booking_expertise_updated',
  'booking_talent_updated',
  'booking_skill_updated',
  'booking_ability_updated',
  'booking_capability_updated',
  'booking_feature_updated',
  'booking_functionality_updated',
  'booking_behavior_updated',
  'booking_interaction_updated',
  'booking_transition_updated',
  'booking_animation_updated',
  'booking_effect_updated',
  'booking_shadow_updated',
  'booking_border_updated',
  'booking_padding_updated',
  'booking_margin_updated',
  'booking_spacing_updated',
  'booking_typography_updated',
  'booking_font_updated',
  'booking_color_updated',
  'booking_icon_updated',
  'booking_logo_updated',
  'booking_image_updated',
  'booking_identity_updated',
  'booking_brand_updated',
  'booking_theme_updated',
  'booking_style_updated',
  'booking_template_updated',
  'booking_design_updated',
  'booking_layout_updated',
  'booking_format_updated',
  'booking_structure_updated',
  'booking_organization_updated',
  'booking_classification_updated',
  'booking_categorization_updated',
  'booking_qualification_updated',
  'booking_quantification_updated',
  'booking_measurement_updated',
  'booking_assessment_updated',
  'booking_evaluation_updated',
  'booking_analysis_updated',
  'booking_computation_updated',
  'booking_calculation_updated',
  'booking_addition_updated',
  'booking_subtraction_updated',
  'booking_multiplication_updated',
  'booking_division_updated',
  'booking_combination_updated',
  'booking_separation_updated',
  'booking_consolidation_updated',
  'booking_splitting_updated',
  'booking_merging_updated',
  'booking_duplication_updated',
  'booking_restoration_updated',
  'booking_deletion_updated',
  'booking_archival_updated',
  'booking_reactivation_updated',
  'booking_suspension_updated',
  'booking_termination_updated',
  'booking_expiration_updated',
  'booking_renewal_updated',
  'booking_upgrade_updated',
  'booking_downgrade_updated',
  'booking_migration_updated',
  'booking_restore_updated',
  'booking_backup_updated',
  'booking_sync_updated',
  'booking_integration_updated',
  'booking_sharing_updated',
  'booking_collaboration_updated',
  'booking_communication_updated',
  'booking_message_updated',
  'booking_notification_updated',
  'booking_alert_updated',
  'booking_reminder_updated',
  'booking_calendar_updated',
  'booking_schedule_updated',
  'booking_events_updated',
  'booking_activity_updated',
  'booking_history_updated',
  'booking_log_updated',
  'booking_audit_updated',
  'booking_compliance_updated',
  'booking_privacy_updated',
  'booking_security_updated',
  'booking_access_updated',
  'booking_permissions_updated',
  'booking_settings_updated',
  'booking_preferences_updated',
  'booking_social_updated',
  'booking_website_updated',
  'booking_email_updated',
  'booking_phone_updated',
  'booking_address_updated',
  'booking_contact_updated',
  'booking_stakeholder_updated',
  'booking_partner_updated',
  'booking_supplier_updated',
  'booking_vendor_updated',
  'booking_client_updated',
  'booking_team_updated',
  'booking_resources_updated',
  'booking_timeline_updated',
  'booking_deliverables_updated',
  'booking_specifications_updated',
  'booking_requirements_updated',
  'booking_scope_updated',
  'booking_budget_updated',
  'booking_deadline_updated',
  'booking_priority_updated',
  'booking_category_changed',
  'booking_tag_removed',
  'booking_tag_added',
  'booking_note_deleted',
  'booking_note_updated',
  'booking_note_added',
  'booking_attachment_removed',
  'booking_attachment_added',
  'booking_document_deleted',
  'booking_document_shared',
  'booking_document_downloaded',
  'booking_document_uploaded',
  'booking_feedback_sent',
  'booking_feedback_received',
  'booking_rated',
  'booking_reviewed',
  'booking_deescalated',
  'booking_escalated',
  'booking_urgency_changed',
  'booking_priority_changed',
  'booking_split',
  'booking_merged',
  'booking_duplicated',
  'booking_imported',
  'booking_exported',
  'booking_shared',
  'booking_deleted',
  'booking_restored',
  'booking_archived',
  'booking_finished',
  'booking_started',
  'booking_confirmed',
  'booking_rescheduled',
  'booking_rejected',
  'booking_approved',
  'booking_unassigned',
  'booking_assigned',
  'booking_status_changed',
  'booking_comment_added',
  'booking_milestone_overdue',
  'booking_milestone_completed',
  'booking_payment_received',
  'booking_payment_due',
  'booking_overdue',
  'booking_reminder',
  'booking_completed',
  'booking_cancelled',
  'booking_updated',
  'booking_created'
));

-- Test the constraint with a simple insert
INSERT INTO booking_notifications (
  booking_id,
  user_id, 
  type, 
  title, 
  message, 
  priority
) VALUES (
  (SELECT id FROM bookings LIMIT 1),
  (SELECT id FROM auth.users LIMIT 1),
  'booking_created',
  'Test Booking Notification',
  'Testing the fixed constraint',
  'high'
) RETURNING id, title, priority, created_at;

-- Clean up test data
DELETE FROM booking_notifications 
WHERE title = 'Test Booking Notification';

-- Success message
SELECT 'âœ… Booking notifications constraint fixed successfully! The type "booking_created" is now allowed.' as status;
